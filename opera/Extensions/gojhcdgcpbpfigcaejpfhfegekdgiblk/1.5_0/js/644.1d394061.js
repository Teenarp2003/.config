"use strict";(self["webpackChunkdesktop_wallet"]=self["webpackChunkdesktop_wallet"]||[]).push([[644],{184:function(e,t,s){s.d(t,{Z:function(){return d}});var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("transition",{attrs:{name:"fade"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.showing,expression:"showing"}],staticClass:"bg-black bg-opacity-40 bottom-0 fixed flex items-center justify-center left-0 right-0 top-0 z-10"},[i("div",{staticClass:"bg-modal flex flex-col items-center max-w-screen-sm mx-10 my-10 px-10 py-7 rounded-lg w-full"},["success"===e.icon?i("img",{staticClass:"h-14 mb-6 w-14",attrs:{src:s(54398)}}):e._e(),e.title?i("div",{staticClass:"font-bold mb-4 text-xl"},[e._v(e._s(e.title))]):e._e(),e.message?i("div",{staticClass:"leading-5 mb-6 opacity-60 text-base text-center text-dark-message"},[e._v(" "+e._s(e.message)+" ")]):e._e(),i("primary-button",{staticClass:"mt-2",attrs:{title:e.action},on:{click:e.runActionAndClose}})],1)])])},n=[],a=s(90108),r={name:"AlertDialog",components:{PrimaryButton:a.Z},props:{icon:{default:"",type:String}},data(){return{action:"",callback:null,message:"",showing:!1,title:""}},methods:{async runActionAndClose(){this.callback&&await this.callback(),this.showing=!1},show(e,t,s,i){this.title=e,this.message=t,this.showing=!0,this.action=s||this.$t("general.dismiss"),this.callback=i}}},l=r,o=s(1001),c=(0,o.Z)(l,i,n,!1,null,"3caef756",null),d=c.exports},67379:function(e,t,s){s.d(t,{Z:function(){return c}});var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"active:brightness-75 flex flex-row h-14 items-center px-4 py-2",on:{click:function(t){e.to?e.$router.push(e.to):e.$emit("click")}}},[s("div",{staticClass:"mr-4 w-4"},[e.icon?s("img",{staticClass:"me-4 text-2xl text-primary-100",attrs:{src:e.icon}}):e._e()]),s("div",[s("div",[e._v(e._s(e.title))]),e.subtitle?s("div",{staticClass:"text-xs",class:e.subtitleClass},[e._v(e._s(e.subtitle))]):e._e()]),s("div",{attrs:{ckass:"flex-grow"}}),e.loading?s("i",{staticClass:"animate-spin icon-spinner"}):e.appendIcon?s("i",{staticClass:"se-4 text-2xl text-primary-100",class:e.appendIcon}):e._e()])},n=[],a={name:"ListItem",components:{},props:{appendIcon:{default:"",type:String},icon:{default:"",type:String},loading:{type:Boolean},subtitle:{default:"",type:String},subtitleClass:{default:"",type:String},title:{default:"",type:String},to:{default:"",type:String}}},r=a,l=s(1001),o=(0,l.Z)(r,i,n,!1,null,null,null),c=o.exports},60408:function(e,t,s){s.d(t,{Z:function(){return c}});var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"flex items-center justify-center"},[s("input",{staticClass:"absolute appearance-none bg-white block border-4 h-6 rounded-full toggle-checkbox w-6",class:e.disabled?"cursor-not-allowed":"cursor-pointer",attrs:{name:"toggle",type:"checkbox"},domProps:{checked:e.checked}}),s("label",{staticClass:"flex h-6 relative select-none w-12",class:e.disabled?"cursor-not-allowed":"cursor-pointer",attrs:{for:"toggle"}},[s("span",{staticClass:"absolute h-full left-0 rounded-full top-0 w-full",class:{"bg-accent":e.checked,"bg-dark-N20":!e.checked}}),s("span",{staticClass:"absolute bg-white border-2 duration-300 ease-in-out flex h-6 items-center justify-center rounded-full transition-transform w-6",class:{"right-0":e.checked,"border-accent":e.checked,"border-dark-N20":!e.checked}})])])},n=[],a={name:"OperaCheckbox",props:{checked:{default:!1,type:Boolean},disabled:{default:!1,type:Boolean}}},r=a,l=s(1001),o=(0,l.Z)(r,i,n,!1,null,null,null),c=o.exports},50113:function(e,t,s){s.d(t,{Z:function(){return c}});var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("transition",{attrs:{name:"fade"}},[e.showing?s("div",{staticClass:"bg-black bottom-0 fade fixed left-0 opacity-60 px-4 right-0 top-0 z-50",on:{click:e.close}}):e._e()]),s("transition",{attrs:{name:"slide"}},[e.showing?s("div",{staticClass:"-translate-x-1/2 bg-modal bottom-0 fixed left-1/2 max-h-screen max-w-screen-sm overflow-y-scroll p-4 rounded-t-3xl w-screen z-50"},[e._t("default")],2):e._e()])],1)},n=[],a={name:"BottomSheet",data(){return{showing:!1}},methods:{close(){this.$emit("close"),this.showing=!1},show(){this.showing=!0}}},r=a,l=s(1001),o=(0,l.Z)(r,i,n,!1,null,"70f89c6e",null),c=o.exports},99667:function(e,t,s){s.d(t,{Z:function(){return h}});var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("bottom-sheet",{ref:"sheet"},[s("div",[e.title?s("div",{staticClass:"font-bold mb-2 text-xl"},[e._v(" "+e._s(e.title)+" ")]):e._e(),e._l(e.items,(function(t){return s("div",{key:t.key,on:{click:function(s){return e.itemClicked(t.key)}}},["listItem"===t.type?s("list-item",{staticClass:"-mx-4",attrs:{"append-icon":t.appendIcon,icon:t.icon,loading:t.loading,subtitle:t.subtitle,"subtitle-class":t.subtitleClass,title:t.title},on:{click:function(s){return e.itemClicked(t.key)}}}):e._e(),"divider"===t.type?s("div",{staticClass:"border-positive-10 border-t my-2"}):e._e()],1)}))],2)])},n=[],a=s(50113),r=s(67379),l={name:"ListSheet",components:{BottomSheet:a.Z,ListItem:r.Z},data(){return{action:null,items:null,onItemClicked:null,title:null}},methods:{itemClicked(e){this.onItemClicked&&this.onItemClicked(e),this.$refs.sheet.close()},show(e,t=[],s,i){this.title=e,this.items=t,this.onItemClicked=s,this.action=i,this.$refs.sheet.show()}}},o=l,c=s(1001),d=(0,c.Z)(o,i,n,!1,null,null,null),h=d.exports},48644:function(e,t,s){s.r(t),s.d(t,{default:function(){return k}});var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"flex flex-col"},[i("top-bar",{attrs:{"back-override":e.backOverride,title:e.$t("general.fioHandle")}}),i("div",{staticClass:"flex flex-col flex-grow items-center px-8 py-8"},[i("div",{staticClass:"bg-n3 flex flex-row items-center p-4 rounded-lg w-full"},[i("img",{staticClass:"h-10 w-10",attrs:{src:s(81741)}}),i("div",{staticClass:"font-bold ms-2 text-center text-emphasis-high text-md"},[e._v(" "+e._s(e.handle)+" ")]),i("div",{staticClass:"flex-grow"})]),i("div",{staticClass:"flex flex-col mt-4 w-full",class:{"pointer-events-none animate-pulse":e.isLoading}},e._l(e.connections,(function(t,s){return i("div",{key:t.symbol,staticClass:"bg-n2 cursor-pointer flex items-center justify-between mb-2 px-4 py-3 rounded-lg",on:{click:function(t){return e.toggle(s)}}},[i("token-icon",{staticClass:"h-10 object-contain rounded-full w-10",attrs:{address:e.nullAddress,chain:e.connection2chain(t)}}),i("div",{staticClass:"flex-1 mx-4"},[i("div",[e._v(e._s(t.name))]),i("div",{staticClass:"text-emphasis-medium text-xs"},[e._v(e._s(s))])]),i("opera-checkbox",{class:"t-fio-"+s+"-switch",attrs:{checked:e.checked(s)}})],1)})),0),i("alert-dialog",{ref:"errorDialog"}),i("list-sheet",{ref:"handleSheet"}),i("div",{staticClass:"bottom-group"},[i("div",{staticClass:"flex-col p-4"},[i("div",{staticClass:"font-bold leading-5 m-8 text-dark-N77 text-sm",class:{"opacity-0":!e.changes.dirty}},[e._v(" "+e._s(e.dirtyText)+" ")]),i("primary-button",{staticClass:"flex-1 w-full",attrs:{disabled:!e.changes.dirty,loading:e.isLoading,title:e.$t("general.save")},on:{click:e.save}})],1)])],1)],1)},n=[],a=(s(57658),s(81732)),r=s(39765),l=s(61346),o=s(49146);function c(e,t){switch(e){case o.Do.INSUFFICIENT_FUNDS:return"errors.generic.insufficientFunds";case o.Do.GAS_INSUFFICIENT_FUNDS:return"errors.insufficientFunds";case o.Do.NERVOS_CKB_NOT_ENOUGH_ERROR:return"errors.nervos.ckb_not_enough";case o.Do.NEAR_AMOUNT_TOO_LOW:return"errors.near.nearAmountTooLow";case o.Do.INVALID_RECIPIENT:return"errors.generic.invalidRecipient";case o.Do.SWAP_SAME_TOKEN:return"errors.swappingTheSameToken";case o.Do.SWAP_INVALID:return"errors.generic.invalidSwap";case o.JS.COULD_NOT_CREATE_WALLET:return"errors.restore.createWallet";case o.JS.COULD_NOT_SAVE_WALLET:return"errors.restore.saveWallet";case o._e.INVALID_MNEMONIC:return"errors.restore.invalidBackupPhrase";case o.JS.MISSING_SECURITY:return"errors.missingSecurity";case o.Do.BTC_AMOUNT_TOO_LOW:return"errors.bitcoin.bitcoinAmountTooLow";default:return t??"errors.somethingWentWrong"}}function d(e,t){switch(e){default:return t??"errors.generic.oops"}}var h=s(184),u=s(99667),f=s(60408),g=s(90108),m=s(56258),p=s(67990),b=s(38423),v=s(79818),_=s(25108),x={name:"FioConnect",components:{AlertDialog:h.Z,ListSheet:u.Z,OperaCheckbox:f.Z,PrimaryButton:g.Z,TokenIcon:p.Z,TopBar:b.Z},data(){return{backOverride:this.$route.params?.backOverride,connections:a.T_,dirtyText:"Your changes need confirmation or they will be discarded if you leave this screen.",handle:"",handles:[],loading:{addresses:!1,connectable:!1,handles:!1,saving:!1},nullAddress:r.L1,selected:{}}},computed:{changes(){const{selected:e}=this,t=this.original(),s=Object.values(t).filter((t=>!e[t.chainCode])),i=Object.values(e).filter((e=>!t[e.chainCode]));return{additions:i,dirty:s.length||i.length,removals:s}},connectable(){const e=this.$store.getters.getFioConnectableAddresses,t={};if(e?.length)for(const s of e)t[s.chainCode]=s;return t},connection2chain(){return e=>(0,l.aP)(e.chainUId)},isLoading(){return Object.values(this.loading).some((e=>!!e))}},watch:{handle:{async handler(e){await this.fetchAllPublicAddressesByHandle(e)},immediate:!0}},async mounted(){m.Z.sendStatsEvent(m.Z.types.IMPRESSION,"wt_setting_fio"),this.handle=this.$route.query.handle,this.loading.handles=!0,await this.$store.dispatch("fetchFioConnectableAddresses"),await this.$store.dispatch("fetchFioHandles"),this.loading.handles=!1},methods:{checked(e){return!!this.selected[e]},async fetchAllPublicAddressesByHandle(e){this.loading.addresses=!0,await this.$store.dispatch("fetchAllPublicAddressesByHandle",e),this.selected={...this.original()},this.loading.addresses=!1},original(){const{connectable:e}=this,t=this.$store.getters.getAllPublicAddressesByHandle(this.handle),s={};if(t.length)for(const i of t)s[i.chain_code]={address:e[i.chain_code]?.address,chainCode:i.chain_code};return s},async save(){await this.untilLoaded(),this.loading.saving=!0,this.$authenticator.lockAuthenticatorWithPassword();try{this.changes.additions.length>0&&await v.Z.fioAddAddresses(this.$store.getters.getFioPublicKey,this.handle,this.changes.additions),this.changes.removals.length>0&&await v.Z.fioRemoveAddresses(this.$store.getters.getFioPublicKey,this.handle,this.changes.removals)}catch(e){_.error("ERROR SAVING",e)}this.$authenticator.clearSecretAndUnlockAuthenticator(),await this.fetchAllPublicAddressesByHandle(this.handle),this.loading.saving=!1},showErrorDialog(e){this.$refs.errorDialog.show(this.$t(d(e.code)),this.$t(c(e.code)),null,(()=>this.$router.replace("/settings")))},showHandleSheet(){if(this.isLoading)return;const e=this.$store.getters.getFioHandles,t=e.map((e=>({appendIcon:this.handle===e?"icon-checkmark":null,key:e,title:e,type:"listItem"})));t.push({type:"divider"}),t.push({icon:"icon-plus",key:"action",title:this.$t("fio.register.createHandle"),type:"listItem"}),this.$refs.handleSheet.show(this.$t("fio.chooseActiveHandle"),t,(t=>{"action"===t?this.$router.push({name:"FioRegister",query:{hasOperaDomain:e.some((e=>e.endsWith("@opera"))).toString()}}):this.handle=t}))},async toggle(e){const t=this.selected[e];t?this.$delete(this.selected,e):this.$set(this.selected,e,{address:this.connectable[e].address,chainCode:e})},untilLoaded(){const e=t=>{const s=this.isLoading;s?setTimeout((()=>e(t)),100):t()};return new Promise((t=>{e(t)}))}}},w=x,C=s(1001),y=(0,C.Z)(w,i,n,!1,null,null,null),k=y.exports},81741:function(e,t,s){e.exports=s.p+"img/fio.9ee8d805.svg"},54398:function(e,t,s){e.exports=s.p+"img/success.5827329e.svg"}}]);